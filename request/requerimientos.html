<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MDSR - REQUERIMIENTOS</title>
    <link rel="stylesheet" href="requerimientos.css">
    <link rel="stylesheet" href="/admin/admin.css">
    <link rel="icon" type="image/png" href="../imgs/LOGO_MUNICIPALIDAD.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
</head>

<body>
    <header class="adr-header">
        <div class="adr-header-content">
            <!-- Logo, t铆tulo y usuario juntos -->
            <div class="adr-logo-section">
                <img src="../imgs/LOGO_MUNICIPALIDAD.png" alt="Logo Municipalidad" class="adr-logo">
                <div class="adr-title-group">
                    <h1 class="adr-main-title">Municipalidad Distrital de San Ram贸n</h1>
                    <p class="adr-subtitle">Bienvenido</p>
                </div>
            </div>

            <!-- Bot贸n hamburguesa -->
            <button class="adr-hamburger" id="hamburgerBtn" aria-label="Men煤">
                <span class="adr-hamburger-line"></span>
                <span class="adr-hamburger-line"></span>
                <span class="adr-hamburger-line"></span>
            </button>

            <!-- Navegaci贸n (se mostrar谩 como men煤 lateral en m贸vil) -->
            <nav class="adr-nav" id="navMenu">
                <a href="/admin/admin.html" class="adr-nav-link">DASHBOARD</a>
                <a href="/request/requerimientos.html" class="adr-nav-link adr-active">REQUERIMIENTOS</a>
                <a href="/flujograma/flujograma.html" class="adr-nav-link">FLUJOGRAMA</a>
                <a href="/log/login.html" class="adr-nav-link adr-nav-salir">SALIR</a>
            </nav>
        </div>
    </header>
    <!-- ========== HEADER ========== -->
    <!-- <header class="adr-header">
        <div class="adr-header-content">
            <button class="adr-btn-back" id="btnRegresar" title="Volver atr谩s">
                <i class="fas fa-arrow-left"></i>
            </button>
            <div class="adr-logo-section">
                <img src="../imgs/LOGO_MUNICIPALIDAD.png" alt="Logo Municipalidad" class="adr-logo">
                <div class="adr-title-group">
                    <h1 class="adr-main-title">隆Bienvenido!</h1>
                    <p class="adr-subtitle">Hola, Administrador</p>
                </div>
            </div>
            <a href="/log/login.html" class="adr-nav-link adr-nav-salir">
                <i class="fas fa-sign-out-alt"></i>
                SALIR
            </a>
        </div>
    </header> -->

    <!-- ========== CONTENIDO PRINCIPAL ========== -->
    <main class="adr-main-container">
        <div class="adr-content-wrapper">

            <!-- ========== HERO: BSQUEDA Y FILTROS ========== -->
            <section class="adr-hero-section">
                <!-- Barra de B煤squeda -->
                <div class="adr-search-container">
                    <i class="fas fa-search adr-search-icon"></i>
                    <input type="text" id="searchInput" class="adr-search-input"
                        placeholder="Buscar requerimientos por ID, 谩rea, tipo o descripci贸n...">
                    <button id="clearSearch" class="adr-search-clear" style="display: none;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <!-- Bot贸n Filtrar -->
                <button class="adr-btn-filtrar" id="btnFiltrar">
                    <i class="fas fa-filter"></i>
                    <span>FILTRAR</span>
                </button>
            </section>

            <!-- ========== PANEL DE FILTROS (EXPANDIBLE) ========== -->
            <section class="adr-filtros-panel" id="filtrosPanel">
                <div class="adr-filtros-content">
                    <h3><i class="fas fa-sliders-h"></i> Filtros Avanzados</h3>

                    <div class="adr-filtros-grid">
                        <!-- Filtro por Fecha -->
                        <div class="adr-filtros-group">
                            <label>Por Fecha:</label>
                            <div class="adr-filtro-rango">
                                <input type="date" id="filtroFechaDesde" class="adr-filtro-input" placeholder="Desde">
                                <span class="adr-filtro-separator">-</span>
                                <input type="date" id="filtroFechaHasta" class="adr-filtro-input" placeholder="Hasta">
                            </div>
                        </div>

                        <!-- Filtro por rea -->
                        <div class="adr-filtros-group">
                            <label>Por rea:</label>
                            <select id="filtroArea" class="adr-filtro-select">
                                <option value="">Todas las 谩reas</option>
                                <option value="Subgerencia de Catastro, Planeamiento y Control Urbano">Subgerencia de
                                    Catastro, Planeamiento y Control Urbano</option>
                                <option value="Subgerencia de Maquinarias">Subgerencia de Maquinarias</option>
                                <option value="Subgerencia de Supervisi贸n y Ejecuci贸n de Obras">Subgerencia de
                                    Supervisi贸n y Ejecuci贸n de Obras</option>
                                <option value="Subgerencia de Medio Ambiente, Ecolog铆a, Saneamiento y Salubridad">
                                    Subgerencia de Medio Ambiente, Ecolog铆a, Saneamiento y Salubridad</option>
                                <option value="Subgerencia de Mercados y Cementerios">Subgerencia de Mercados y
                                    Cementerios</option>
                                <option value="Subgerencia de Transporte, Tr谩nsito y Circulaci贸n Vial">Subgerencia de
                                    Transporte, Tr谩nsito y Circulaci贸n Vial</option>
                                <option value="Subgerencia de Seguridad Ciudadana">Subgerencia de Seguridad Ciudadana
                                </option>
                                <option value="Subgerencia de Educaci贸n, Cultura, Deportes y Recreaci贸n">Subgerencia de
                                    Educaci贸n, Cultura, Deportes y Recreaci贸n</option>
                                <option value="Subgerencia de Defensor铆a Municipal del Ni帽o y Adolescente">Subgerencia
                                    de Defensor铆a Municipal del Ni帽o y Adolescente</option>
                                <option value="Subgerencia Municipal Persona con Discapacidad">Subgerencia Municipal
                                    Persona con Discapacidad</option>
                                <option value="Subgerencia de Participaci贸n Vecinal y Organizaciones Sociales">
                                    Subgerencia de Participaci贸n Vecinal y Organizaciones Sociales</option>
                                <option value="Subgerencia de Desarrollo Tur铆stico y Promoci贸n Empresarial PYMES">
                                    Subgerencia de Desarrollo Tur铆stico y Promoci贸n Empresarial PYMES</option>
                                <option value="Subgerencia de Proyectos Agropecuarios">Subgerencia de Proyectos
                                    Agropecuarios</option>
                                <option value="Programa del Vaso de Leche">Programa del Vaso de Leche</option>
                                <option value="Programa PAN-TBC">Programa PAN-TBC</option>
                                <option value="Unidad de Agua y Alcantarillado">Unidad de Agua y Alcantarillado</option>
                                <option value="Agencias Municipales">Agencias Municipales</option>
                                <option value="Subgerencia de Abastecimiento">Subgerencia de Abastecimiento</option>
                                <option value="Subgerencia de Contabilidad">Subgerencia de Contabilidad</option>
                                <option value="Subgerencia de Tesorer铆a">Subgerencia de Tesorer铆a</option>
                                <option value="Subgerencia de Personal">Subgerencia de Personal</option>
                                <option value="Subgerencia de Control Patrimonial">Subgerencia de Control Patrimonial
                                </option>
                                <option value="Subgerencia de Recaudaci贸n y Control">Subgerencia de Recaudaci贸n y
                                    Control</option>
                                <option value="Subgerencia de Fiscalizaci贸n Tributaria">Subgerencia de Fiscalizaci贸n
                                    Tributaria</option>
                                <option value="Subgerencia de Ejecuci贸n Coactiva">Subgerencia de Ejecuci贸n Coactiva
                                </option>
                                <option value="Subgerencia de Comercializaci贸n, Comercio Ambulatorio y Feria">
                                    Subgerencia de Comercializaci贸n, Comercio Ambulatorio y Feria</option>
                                <option value="Oficina de Asesor铆a Jur铆dica">Oficina de Asesor铆a Jur铆dica</option>
                                <option value="Oficina de Planeamiento, Presupuesto y Racionalizaci贸n">Oficina de
                                    Planeamiento, Presupuesto y Racionalizaci贸n</option>
                                <option value="Oficina de Tecnolog铆a">Oficina de Tecnolog铆a</option>
                                <option value="Oficina de Secretar铆a General">Oficina de Secretar铆a General</option>
                                <option value="Unidad Tr谩mite Documentario">Unidad Tr谩mite Documentario</option>
                                <option value="Unidad de Archivo Central">Unidad de Archivo Central</option>
                                <option value="Unidad de Orientaci贸n a la Ciudadan铆a">Unidad de Orientaci贸n a la
                                    Ciudadan铆a</option>
                            </select>
                        </div>

                        <!-- Filtro por Tipo -->
                        <div class="adr-filtros-group">
                            <label>Por Tipo:</label>
                            <select id="filtroTipo" class="adr-filtro-select">
                                <option value="">Todos los tipos</option>
                                <option value="Bien">Bien</option>
                                <option value="Servicio">Servicio</option>
                                <option value="Obra">Obra</option>
                            </select>
                        </div>

                        <!-- Filtro por Monto -->
                        <div class="adr-filtros-group">
                            <label>Por Monto:</label>
                            <div class="adr-filtro-rango">
                                <input type="number" id="filtroMontoMin" class="adr-filtro-input" placeholder="M铆nimo"
                                    min="0" step="0.01">
                                <span class="adr-filtro-separator">-</span>
                                <input type="number" id="filtroMontoMax" class="adr-filtro-input" placeholder="M谩ximo"
                                    min="0" step="0.01">
                            </div>
                        </div>

                        <!-- Filtro por Estado -->
                        <div class="adr-filtros-group">
                            <label>Por Estado:</label>
                            <select id="filtroEstado" class="adr-filtro-select">
                                <option value="">Todos los estados</option>
                                <option value="PENDIENTE">Pendiente</option>
                                <option value="EN PROCESO">En Proceso</option>
                                <option value="FINALIZADO">Finalizado</option>
                            </select>
                        </div>
                    </div>

                    <!-- Botones del Filtro -->
                    <div class="adr-filtros-buttons">
                        <button class="adr-btn-aplicar-filtros">
                            <i class="fas fa-check"></i>
                            Aplicar Filtros
                        </button>
                        <button class="adr-btn-limpiar-filtros">
                            <i class="fas fa-eraser"></i>
                            Limpiar Filtros
                        </button>
                    </div>
                </div>
            </section>

            <!-- ========== TABLA DE REQUERIMIENTOS ========== -->
            <section class="adr-table-section">
                <div class="adr-table-container">
                    <table class="adr-requerimientos-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>FECHA</th>
                                <th>REA</th>
                                <th>TIPO</th>
                                <th>MONTO</th>
                                <th>ESTADO</th>
                                <th>ACCIONES</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Los datos se cargan din谩micamente desde Firebase -->
                        </tbody>
                    </table>
                </div>
            </section>
        </div>
    </main>

    <!-- ========== MODAL DE DETALLES ========== -->
    <div class="adr-modal" id="modalDetalles">
        <div class="adr-modal-overlay"></div>
        <div class="adr-modal-content">
            <!-- Header del Modal -->
            <div class="adr-modal-header">
                <div class="adr-modal-title">
                    <i class="fas fa-file-alt"></i>
                    <h2>DETALLES DEL REQUERIMIENTO</h2>
                </div>
                <button class="adr-modal-close" id="btnCerrarModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- Contenido del Modal -->
            <div class="adr-modal-body">
                <!-- T铆tulo del Requerimiento -->
                <div class="adr-modal-titulo-section">
                    <i class="fas fa-heading"></i>
                    <h3 id="modalTituloReq">Sin t铆tulo</h3>
                </div>

                <!-- Informaci贸n del Requerimiento -->
                <div class="adr-modal-info-grid">
                    <div class="adr-modal-info-item">
                        <i class="fas fa-hashtag"></i>
                        <div>
                            <span class="adr-modal-label">ID</span>
                            <span class="adr-modal-value" id="modalId">-</span>
                        </div>
                    </div>

                    <div class="adr-modal-info-item">
                        <i class="fas fa-calendar"></i>
                        <div>
                            <span class="adr-modal-label">Fecha</span>
                            <span class="adr-modal-value" id="modalFecha">-</span>
                        </div>
                    </div>

                    <div class="adr-modal-info-item">
                        <i class="fas fa-building"></i>
                        <div>
                            <span class="adr-modal-label">rea</span>
                            <span class="adr-modal-value" id="modalArea">-</span>
                        </div>
                    </div>

                    <div class="adr-modal-info-item">
                        <i class="fas fa-tag"></i>
                        <div>
                            <span class="adr-modal-label">Tipo</span>
                            <span class="adr-modal-value" id="modalTipo">-</span>
                        </div>
                    </div>

                    <div class="adr-modal-info-item">
                        <i class="fas fa-dollar-sign"></i>
                        <div>
                            <span class="adr-modal-label">Monto</span>
                            <span class="adr-modal-value" id="modalMonto">-</span>
                        </div>
                    </div>

                    <div class="adr-modal-info-item">
                        <i class="fas fa-info-circle"></i>
                        <div>
                            <span class="adr-modal-label">Estado</span>
                            <span class="adr-modal-value" id="modalEstado">-</span>
                        </div>
                    </div>
                </div>

                <!-- Descripci贸n -->
                <div class="adr-modal-section">
                    <h3><i class="fas fa-align-left"></i> Descripci贸n</h3>
                    <p class="adr-modal-descripcion" id="modalDescripcion">-</p>
                </div>

                <div class="adr-modal-section" id="pdfSectionAdmin" style="display: none;">
                    <h3><i class="fas fa-file-pdf"></i> Archivos Adjuntos</h3>
                    <div class="adr-pdfs-container" id="modalPdfs">
                    </div>
                </div>

                <!-- Cambiar Estado -->
                <div class="adr-modal-section">
                    <h3><i class="fas fa-exchange-alt"></i> Cambiar Estado</h3>
                    <div class="adr-estado-buttons">
                        <button class="adr-estado-btn adr-estado-pendiente" data-estado="PENDIENTE">
                            <i class="fas fa-clock"></i> PENDIENTE
                        </button>
                        <button class="adr-estado-btn adr-estado-proceso" data-estado="EN PROCESO">
                            <i class="fas fa-spinner"></i> EN PROCESO
                        </button>
                        <button class="adr-estado-btn adr-estado-finalizado" data-estado="FINALIZADO">
                            <i class="fas fa-check-circle"></i> FINALIZADO
                        </button>
                    </div>
                </div>

                <!-- Comentarios del Admin -->
                <div class="adr-modal-section">
                    <h3><i class="fas fa-comment-dots"></i> Agregar Comentario</h3>
                    <textarea id="modalComentario" class="adr-modal-textarea"
                        placeholder="Escribe un comentario que ser谩 visible para el usuario..." rows="4"></textarea>
                    <button class="adr-btn-guardar-comentario" id="btnGuardarComentario">
                        <i class="fas fa-save"></i>
                        Guardar Comentario
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="adr-pdf-viewer-modal" id="pdfViewerModalAdmin">
        <div class="adr-pdf-viewer-container">
            <div class="adr-pdf-viewer-header">
                <div class="adr-pdf-viewer-title">
                    <i class="fas fa-file-pdf"></i>
                    <span id="pdfViewerFileNameAdmin">Visualizador de PDF</span>
                </div>
                <button class="adr-pdf-viewer-close" id="closePdfViewerAdmin">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="adr-pdf-viewer-content">
                <iframe id="pdfViewerIframeAdmin" class="adr-pdf-viewer-iframe"></iframe>
            </div>
        </div>
    </div>
    <!-- ========== NOTIFICACIN ========== -->
    <div class="adr-notification" id="notificacion">
        <i class="fas fa-check-circle"></i>
        <span>Operaci贸n exitosa</span>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import {
            getFirestore, collection, onSnapshot
        } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

        // Configuraci贸n corregida
        const firebaseConfig = {
            apiKey: "AIzaSyD-V6hfGyOETDNxJf8Stb9DujbxQTIM76c",
            authDomain: "web-requerimientos.firebaseapp.com",
            projectId: "web-requerimientos",
            storageBucket: "web-requerimientos.appspot.com",
            messagingSenderId: "707688130249",
            appId: "1:707688130249:web:c46b6252c46083b6e9cf18",
            measurementId: "G-TV2C27SXD3"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        //  Verifica sesi贸n activa
        onAuthStateChanged(auth, user => {
            if (user) {
                document.querySelector('.adr-subtitle').textContent = `Hola, ${user.email}`;
            } else {
                window.location.href = "/log/login.html";
            }
        });
    </script>
    <script type="module" src="/request/requerimientos.js"></script>
    <script>
        // Scroll al inicio al cargar
        window.addEventListener('load', () => {
            window.scrollTo(0, 0);
            document.documentElement.scrollTop = 0;
            document.body.scrollTop = 0;
        });

        // Scroll al inicio al mostrar modales
        document.addEventListener('DOMContentLoaded', () => {
            const modals = document.querySelectorAll('.modal-overlay, .adr-modal');
            modals.forEach(modal => {
                const observer = new MutationObserver(() => {
                    if (modal.classList.contains('active')) {
                        const modalContent = modal.querySelector('.modal-content, .create-modal, .detail-modal');
                        if (modalContent) {
                            modalContent.scrollTop = 0;
                        }
                    }
                });
                observer.observe(modal, { attributes: true, attributeFilter: ['class'] });
            });
        });
    </script>
    <!-- Overlay (NICO) -->
    <div class="adr-menu-overlay" id="menuOverlay"></div>

    <!-- JavaScript del men煤 (NICO) -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const hamburger = document.getElementById('hamburgerBtn');
            const nav = document.getElementById('navMenu');
            const overlay = document.getElementById('menuOverlay');
            const body = document.body;

            function toggleMenu() {
                hamburger.classList.toggle('active');
                nav.classList.toggle('active');
                overlay.classList.toggle('active');
                body.style.overflow = nav.classList.contains('active') ? 'hidden' : '';
            }

            function closeMenu() {
                hamburger.classList.remove('active');
                nav.classList.remove('active');
                overlay.classList.remove('active');
                body.style.overflow = '';
            }

            // Abrir/cerrar men煤
            if (hamburger) hamburger.addEventListener('click', toggleMenu);

            // Cerrar con overlay
            if (overlay) overlay.addEventListener('click', closeMenu);

            // Cerrar al hacer clic en un enlace
            const navLinks = document.querySelectorAll('.adr-nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', closeMenu);
            });

            // Cerrar con tecla ESC
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape' && nav.classList.contains('active')) {
                    closeMenu();
                }
            });

            // Cerrar si cambias a desktop
            let resizeTimer;
            window.addEventListener('resize', function () {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(function () {
                    if (window.innerWidth > 768 && nav.classList.contains('active')) {
                        closeMenu();
                    }
                }, 250);
            });
        });
    </script>
</body>

</html>